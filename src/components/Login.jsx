import React, {useState}   from "react";
import { Button, Form, Card,Row, Alert } from 'react-bootstrap'; 
import { Link } from 'react-router-dom';
import { useNavigate } from 'react-router-dom';
import {LoginService} from '../api/glicemiappService';


const Login = () => {
    
    const [email, setEmail] = useState('');
    const [password, setPassword] = useState('');
    const [error, setError] = useState('');


    const history = useNavigate();
    const handlechange = (e) => {
        if (e.target.name === 'email') {
            setEmail(e.target.value);
        } else {
            setPassword(e.target.value);
        }
    }
    const handleSubmit = async(e) => {
        e.preventDefault();
        try {
            const response = await LoginService( email, password );
            if (response.status === 200) {
                // Guardar el token en el localStorage o en un contexto global
                localStorage.setItem('accessToken', response.data.access);
                localStorage.setItem('refreshToken', response.data.refresh);
                localStorage.setItem('usuario_cedula', JSON.stringify(response.data.usuario.cedula));
                localStorage.setItem('tipo',JSON.parse(JSON.stringify(response.data.usuario.tipo)));

                history('/');
            }
        } catch (error) {
            if (error.response && error.response.status === 401) {
                setError('Credenciales incorrectas');
            } else {
                setError('Error al iniciar sesión, intente nuevamente');
            }
        }
    }

    return (
        
    <Card className="mx-auto logregcard" style={{ width: '22rem', marginTop: '50px' }}>
        <svg width="8rem" height="8rem" viewBox="0 0 148 213" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M139.018 42.3713C142.228 39.1632 147.713 41.5473 147.556 46.0824L141.969 207.877C141.831 211.872 137.289 214.093 134.044 211.752L37.7035 142.232C36.7672 141.557 36.0934 140.579 35.7963 139.463L0.39317 6.5688C-0.963456 1.47635 5.46771 -1.9717 8.96758 1.97165L85.5808 88.2924C87.4929 90.4467 90.8249 90.5475 92.8606 88.5125L139.018 42.3713Z" fill="#FE2472"/>
</svg>

        <Card.Header className="CardHeader">
        <svg className="" width="auto" height="auto"viewBox="0 0 349 61" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path d="M30.7575 40.896H30.4375C30.0962 43.1573 28.9442 45.0347 26.9815 46.528C25.0188 48.0213 22.3522 48.768 18.9815 48.768C16.4215 48.768 14.0322 48.2773 11.8135 47.296C9.59484 46.3147 7.65351 44.864 5.98951 42.944C4.32551 41.024 3.02418 38.6347 2.08551 35.776C1.14684 32.9173 0.677509 29.6107 0.677509 25.856C0.677509 22.1013 1.16818 18.7733 2.14951 15.872C3.13084 12.9707 4.49618 10.5387 6.24551 8.576C8.03751 6.61333 10.1708 5.12 12.6455 4.096C15.1202 3.072 17.8722 2.56 20.9015 2.56C24.9122 2.56 28.3682 3.43466 31.2695 5.184C34.1708 6.89067 36.4535 9.472 38.1175 12.928L30.1815 17.472C29.4988 15.7227 28.4322 14.2507 26.9815 13.056C25.5308 11.8187 23.5042 11.2 20.9015 11.2C17.8722 11.2 15.4615 12.0747 13.6695 13.824C11.8775 15.5733 10.9815 18.3253 10.9815 22.08V29.248C10.9815 32.96 11.8775 35.712 13.6695 37.504C15.4615 39.2533 17.8722 40.128 20.9015 40.128C22.0962 40.128 23.2268 40 24.2935 39.744C25.3602 39.4453 26.2988 39.0187 27.1095 38.464C27.9202 37.8667 28.5388 37.1627 28.9655 36.352C29.4348 35.5413 29.6695 34.5813 29.6695 33.472V31.232H21.3495V23.104H38.9495V48H30.7575V40.896ZM57.7415 48C54.4988 48 52.1095 47.2107 50.5735 45.632C49.0802 44.0533 48.3335 41.7707 48.3335 38.784V0.639999H57.8055V40.64H62.0295V48H57.7415ZM72.8845 10.816C70.9645 10.816 69.5565 10.3893 68.6605 9.536C67.8072 8.64 67.3805 7.50933 67.3805 6.144V4.736C67.3805 3.37067 67.8072 2.26133 68.6605 1.408C69.5565 0.511998 70.9645 0.0639992 72.8845 0.0639992C74.8045 0.0639992 76.1912 0.511998 77.0445 1.408C77.9405 2.26133 78.3885 3.37067 78.3885 4.736V6.144C78.3885 7.50933 77.9405 8.64 77.0445 9.536C76.1912 10.3893 74.8045 10.816 72.8845 10.816ZM68.1485 14.4H77.6205V48H68.1485V14.4ZM100.469 48.768C97.9517 48.768 95.7117 48.3627 93.749 47.552C91.7863 46.6987 90.1437 45.5253 88.821 44.032C87.4983 42.496 86.4957 40.64 85.813 38.464C85.1303 36.288 84.789 33.856 84.789 31.168C84.789 28.48 85.1303 26.0693 85.813 23.936C86.4957 21.76 87.4983 19.904 88.821 18.368C90.1437 16.832 91.7863 15.6587 93.749 14.848C95.7117 14.0373 97.9517 13.632 100.469 13.632C103.882 13.632 106.72 14.4 108.981 15.936C111.285 17.472 112.928 19.6267 113.909 22.4L106.229 25.728C105.93 24.448 105.312 23.36 104.373 22.464C103.434 21.568 102.133 21.12 100.469 21.12C98.549 21.12 97.0983 21.76 96.117 23.04C95.1357 24.2773 94.645 25.9627 94.645 28.096V34.368C94.645 36.5013 95.1357 38.1867 96.117 39.424C97.0983 40.6613 98.549 41.28 100.469 41.28C102.176 41.28 103.52 40.832 104.501 39.936C105.525 38.9973 106.272 37.7813 106.741 36.288L114.101 39.488C112.992 42.688 111.264 45.0347 108.917 46.528C106.613 48.0213 103.797 48.768 100.469 48.768ZM134.107 48.768C131.547 48.768 129.264 48.3627 127.259 47.552C125.254 46.6987 123.547 45.5253 122.139 44.032C120.774 42.496 119.728 40.64 119.003 38.464C118.32 36.288 117.979 33.856 117.979 31.168C117.979 28.5227 118.32 26.1333 119.003 24C119.686 21.824 120.688 19.968 122.011 18.432C123.376 16.896 125.04 15.7227 127.003 14.912C128.966 14.0587 131.206 13.632 133.723 13.632C136.496 13.632 138.864 14.1013 140.827 15.04C142.832 15.9787 144.454 17.2373 145.691 18.816C146.971 20.3947 147.888 22.2293 148.443 24.32C149.04 26.368 149.339 28.5227 149.339 30.784V33.6H127.771V34.112C127.771 36.3307 128.368 38.1013 129.563 39.424C130.758 40.704 132.635 41.344 135.195 41.344C137.158 41.344 138.758 40.96 139.995 40.192C141.232 39.3813 142.384 38.4213 143.451 37.312L148.187 43.2C146.694 44.9493 144.731 46.3147 142.299 47.296C139.91 48.2773 137.179 48.768 134.107 48.768ZM133.915 20.608C131.995 20.608 130.48 21.248 129.371 22.528C128.304 23.7653 127.771 25.4293 127.771 27.52V28.032H139.547V27.456C139.547 25.408 139.078 23.7653 138.139 22.528C137.243 21.248 135.835 20.608 133.915 20.608Z" fill="#9C26B0"/>
  <path d="M156.469 48V14.4H165.941V20.096H166.325C166.922 18.304 167.946 16.7893 169.397 15.552C170.847 14.272 172.831 13.632 175.349 13.632C177.653 13.632 179.615 14.208 181.237 15.36C182.858 16.512 184.031 18.1973 184.757 20.416H184.949C185.247 19.4773 185.695 18.6027 186.293 17.792C186.933 16.9387 187.701 16.2133 188.597 15.616C189.493 15.0187 190.495 14.5493 191.605 14.208C192.714 13.824 193.909 13.632 195.189 13.632C198.431 13.632 200.906 14.784 202.613 17.088C204.362 19.392 205.237 22.6773 205.237 26.944V48H195.765V27.712C195.765 23.4453 194.229 21.312 191.157 21.312C189.749 21.312 188.469 21.7173 187.317 22.528C186.165 23.3387 185.589 24.576 185.589 26.24V48H176.117V27.712C176.117 23.4453 174.581 21.312 171.509 21.312C170.826 21.312 170.143 21.4187 169.461 21.632C168.821 21.8027 168.223 22.1013 167.669 22.528C167.157 22.9547 166.73 23.488 166.389 24.128C166.09 24.7253 165.941 25.4293 165.941 26.24V48H156.469ZM218.832 10.816C216.912 10.816 215.504 10.3893 214.608 9.536C213.755 8.64 213.328 7.50933 213.328 6.144V4.736C213.328 3.37067 213.755 2.26133 214.608 1.408C215.504 0.511998 216.912 0.0639992 218.832 0.0639992C220.752 0.0639992 222.139 0.511998 222.992 1.408C223.888 2.26133 224.336 3.37067 224.336 4.736V6.144C224.336 7.50933 223.888 8.64 222.992 9.536C222.139 10.3893 220.752 10.816 218.832 10.816ZM214.096 14.4H223.568V48H214.096V14.4ZM260.881 48L257.681 37.376H242.769L239.569 48H229.713L244.433 3.328H256.465L270.993 48H260.881ZM250.321 12.16H250.001L245.073 29.12H255.313L250.321 12.16ZM277.101 14.4H286.573V20.032H286.893C287.362 18.1547 288.429 16.6187 290.093 15.424C291.8 14.2293 293.741 13.632 295.917 13.632C300.184 13.632 303.405 15.1253 305.581 18.112C307.757 21.0987 308.845 25.4507 308.845 31.168C308.845 36.8853 307.757 41.2587 305.581 44.288C303.405 47.2747 300.184 48.768 295.917 48.768C294.808 48.768 293.762 48.5973 292.781 48.256C291.8 47.9573 290.904 47.5307 290.093 46.976C289.325 46.3787 288.664 45.696 288.109 44.928C287.554 44.1173 287.149 43.264 286.893 42.368H286.573V60.8H277.101V14.4ZM292.781 41.088C294.573 41.088 296.045 40.4693 297.197 39.232C298.392 37.952 298.989 36.2453 298.989 34.112V28.288C298.989 26.1547 298.392 24.4693 297.197 23.232C296.045 21.952 294.573 21.312 292.781 21.312C290.989 21.312 289.496 21.76 288.301 22.656C287.149 23.5093 286.573 24.704 286.573 26.24V36.16C286.573 37.696 287.149 38.912 288.301 39.808C289.496 40.6613 290.989 41.088 292.781 41.088ZM316.479 14.4H325.951V20.032H326.271C326.74 18.1547 327.807 16.6187 329.471 15.424C331.177 14.2293 333.119 13.632 335.295 13.632C339.561 13.632 342.783 15.1253 344.958 18.112C347.134 21.0987 348.222 25.4507 348.222 31.168C348.222 36.8853 347.134 41.2587 344.958 44.288C342.783 47.2747 339.561 48.768 335.295 48.768C334.185 48.768 333.14 48.5973 332.159 48.256C331.177 47.9573 330.281 47.5307 329.471 46.976C328.703 46.3787 328.041 45.696 327.487 44.928C326.932 44.1173 326.527 43.264 326.271 42.368H325.951V60.8H316.479V14.4ZM332.159 41.088C333.951 41.088 335.423 40.4693 336.575 39.232C337.769 37.952 338.367 36.2453 338.367 34.112V28.288C338.367 26.1547 337.769 24.4693 336.575 23.232C335.423 21.952 333.951 21.312 332.159 21.312C330.367 21.312 328.873 21.76 327.679 22.656C326.527 23.5093 325.951 24.704 325.951 26.24V36.16C325.951 37.696 326.527 38.912 327.679 39.808C328.873 40.6613 330.367 41.088 332.159 41.088Z" fill="#FE2472"/>
</svg>

        </Card.Header>
        <Card.Body>
            <Form onSubmit={handleSubmit}>
                <Form.Group className="mb-3" controlId="formBasicEmail">
                    <Form.Label>Email</Form.Label>
                    <Form.Control type="email" placeholder="Ingresar email" name="email" value={email} onChange={handlechange} />
                </Form.Group>

                <Form.Group className="mb-3" controlId="formBasicPassword">
                    <Row>
                        <Form.Label className="col-4">Contraseña</Form.Label>
                   </Row>
                    <Form.Control type="password" placeholder="Contraseña" name="password" value={password} onChange={handlechange} />
                </Form.Group>
                <Form.Group className="mb-3" controlId="formBasicCheckbox">
                    <Form.Label className='reglabel'>¿No estas registrado? <Link to="/reg">registrate aquí</Link></Form.Label> 
                    <Form.Label className='reglabel'>¿Olvidaste tu contraseña? <Link to="/recuperar-contrasena">recupérala aquí</Link></Form.Label> 
                </Form.Group>
                <div className="text-center">
                    <Alert variant="danger" className="mt-3" show={error}>
                        {error}
                    </Alert>
                    <Button variant="primary"  type="submit">
                        Iniciar Sesión
                    </Button>
                </div>
            </Form>
        </Card.Body>
    </Card>
    );
}
export default Login;
